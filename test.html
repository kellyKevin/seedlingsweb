<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Data from Firestore</title>
    <link rel="stylesheet" href="test.css">
</head>

<body>
    <div class="container" id="fruits-container">
        <!-- Fruits data will be inserted here -->
    </div>
    <div class="container" id="trees-container">
        <!-- Trees data will be inserted here -->
    </div>

    <!-- Firebase JS SDK -->
    <script type="module">
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore.js";
        import { getStorage } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-storage.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBUZJDLktz7qBHUPj_XtPybxz3vkz5cYlQ",
            authDomain: "seedlingsweb-b6e5e.firebaseapp.com",
            projectId: "seedlingsweb-b6e5e",
            storageBucket: "seedlingsweb-b6e5e.appspot.com",
            messagingSenderId: "1042431917002",
            appId: "1:1042431917002:web:ebea14cb0326379967ed33",
            measurementId: "G-JVWHZPDJX7"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Function to create a card element
        function createCard(docId, data) {
            return `
                <div class="card" onclick="fetchAndDisplayImages('${docId}', '${data.imagetree1}', '${data.imagetree2}', '${data.imagetree3}')">
                    <img src="${data.imagetree1}" alt="${data.Description}">
                    <div class="card-title">${docId}</div>
                    <div class="card-desc">${data.Description}</div>
                    <div class="card-price">${data.price}</div>
                </div>
            `;
        }

        // Function to fetch and display images from Firebase Storage
        async function fetchAndDisplayImages(docId, image1, image2, image3) {
            try {
                const promises = [];

                // Function to fetch each image and append to the document
                async function fetchImage(imageUrl) {
                    const ref = storage.refFromURL(imageUrl);
                    const url = await ref.getDownloadURL();
                    const img = new Image();
                    img.src = url;
                    img.alt = docId; // Use document ID as alt text
                    img.classList.add('tree-image'); // Add a class for styling
                    document.body.appendChild(img); // Append image to body (you can append to a specific container)
                }

                // Push each image fetching promise into promises array
                if (image1) {
                    promises.push(fetchImage(image1));
                }
                if (image2) {
                    promises.push(fetchImage(image2));
                }
                if (image3) {
                    promises.push(fetchImage(image3));
                }

                // Wait for all images to be fetched
                await Promise.all(promises);

                console.log(`Images for ${docId} fetched successfully.`);
            } catch (error) {
                console.error(`Error fetching images for ${docId}:`, error);
            }
        }

        // Function to display data from a Firestore collection
        async function displayCollection(collectionName, containerId) {
            try {
                console.log(`Fetching data from collection: ${collectionName}`);
                const container = document.getElementById(containerId);
                container.innerHTML = ''; // Clear existing content
                const querySnapshot = await getDocs(collection(db, collectionName));
                if (querySnapshot.empty) {
                    container.innerHTML = `<p>No data found in the ${collectionName} collection.</p>`;
                } else {
                    querySnapshot.forEach((doc) => {
                        container.innerHTML += createCard(doc.id, doc.data());
                    });
                }
                console.log(`Data from ${collectionName} displayed successfully.`);
            } catch (error) {
                console.error(`Error fetching data from ${collectionName}:`, error);
            }
        }

        // Display both collections
        displayCollection("fruits ", "fruits-container");
        displayCollection("trees", "trees-container");
    </script>
</body>

</html>
